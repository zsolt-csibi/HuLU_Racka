#!/bin/bash

cd /project/c_racka1/racka_komondor/src/eval/HuLU_Racka/evaluate

source /project/c_racka1/miniconda_install/bin/activate
conda activate eval_qwen

export GPUS_PER_NODE=1
export HF_HOME="/project/c_racka1/racka_komondor/.cache/huggingface"
export XDG_CACHE_HOME="/project/c_racka1/racka_komondor/.cache"
export FSDP_CONFIG="/project/c_racka1/racka_komondor/scripts/racka_config.yaml"

set -a
source /project/c_racka1/racka_komondor/src/eval/HuLU_Racka/evaluate/.env
set +a

# Get the number of iterations from the first argument
n=${1:-1}

# Run the python script n times
for ((i=1; i<=n; i++)); do
    echo "Running iteration $i of $n"
    python3 test_train.py --config-file config_racka.json
done